<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
		<title>Body Performer</title>
		<!--script src="http://debug.phonegap.com/target/target-script-min.js#rest"></script-->
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3&sensor=true"></script>
		<script type="text/javascript" src="js/cordova-2.2.0.js"></script>
		<script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
		<script type="text/javascript" src="js/jquery.mobile-1.2.0.min.js"></script>   
		<link rel="stylesheet" href="jquery.mobile-1.2.0.min.css" />
		<script type="text/javascript" src="js/jquery.ui.map/jquery.ui.map.full.min.js"></script>
		<script type="text/javascript" src="js/jquery.ui.map/jquery.ui.map.services.min.js"></script>

		<style>
				.iwContainer {
					width: 130px; 
					height: 50px;
					font-family: Arial, Helvetica, sans-serif;
					font-size: 9px;
				} 
		</style>
		<script type="text/javascript">
			var db;
			var dbCreated = false;
			
			var cordovaLoaded = false;
			
			document.addEventListener("deviceready", onDeviceReady, false);
			
			function onDeviceReady(){
				cordovaLoaded = true;
				initDB();
				
			}
			$('#weight_list').live('pageinit',initDB);
			//$(document).on('pageinit', '#trackRoute', function(){
			//	onTrackRoute();	
			//});

			var mobileDemo = { 'center': '57.7973333,12.0502107', 'zoom': 10 };
				
			////////////////////////////////////////////////////////////
			
			$('#basic_map').live('pageinit', function() {
				$('#map_canvas').gmap({'center': mobileDemo.center, 'zoom': mobileDemo.zoom, 'disableDefaultUI':true, 'callback': function() {
					var self = this;
					self.addMarker({'position': this.get('map').getCenter() }).click(function() {
						self.openInfoWindow({ 'content': 'Hello World!' }, this);
					});
				}}); 
				
			});
			
			$('#basic_map').live('pageshow', function() {
				$('#map_canvas').gmap('refresh');
			});
			
			//$('#basic_map').live('pagebeforeshow',function(e,data){ 
			//	$('#map_canvas').height($(window).height() - (10 + $('[data-role=header]').height() - $('[data-role=footer]').height())); 
			//});

			function initDB() {
				db = window.openDatabase("BodyPerformer", "1.0", "Body Performer DB", 200000);
				if (dbCreated)
					db.transaction(getWeightList, transaction_error);
				else
					db.transaction(populateDB, transaction_error, populateDB_success);
			}

			function transaction_error(tx, error) {
				$('#busy').hide();
				alert("Database Error: " + error);
			}

			function populateDB_success() {
				dbCreated = true;
				db.transaction(getWeightList, transaction_error);
			}

			function getWeightList(tx) {
				var sql = "select w.id, w.value from weight w order by w.id";
			//	var sql = "select e.id, e.firstName, e.lastName, e.title, e.picture, count(r.id) reportCount " + 
			//				"from employee e left join employee r on r.managerId = e.id " +
			//				"group by e.id order by e.lastName, e.firstName";
				tx.executeSql(sql, [], getWeightList_success);
			}

			function getWeightList_success(tx, results) {
				$('#busy').hide();
				var len = results.rows.length;
				for (var i=0; i<len; i++) {
					var weight = results.rows.item(i);
					
					$('#weightList').append($('<li/>', {    //here appending `<li>`
						'data-role': "list-divider"
							}).append($('<a/>', {    //here appending `<a>` into `<li>`
								'href': '#',
							//    'data-transition': 'slide',
								'text': weight.value
							})));


					
					//$('#weightList').append('<li>'+weight.value+'</li>');
			//		<a href="employeedetails.html?id=' + employee.id + '">' +
			//		'<img src="pics/' + employee.picture + '" class="list-icon"/>' +
			//		'<p class="line1">' + employee.firstName + ' ' + employee.lastName + '</p>' +
			//		'<p class="line2">' + employee.title + '</p>' +
			//		'<span class="bubble">' + employee.reportCount + '</span></a>
				}
				$('#weightList').listview('refresh');
				db = null;
			}

			function populateDB(tx) {
				$('#busy').show();
				tx.executeSql('DROP TABLE IF EXISTS weight');
				var sql = 
					"CREATE TABLE IF NOT EXISTS weight ( "+
					"id INTEGER PRIMARY KEY AUTOINCREMENT, " +
					"value FLOAT)";
				
				//var sql = 
				//	"CREATE TABLE IF NOT EXISTS weight ( "+
				//	"id unique, " +
				//	"value)";
				tx.executeSql(sql);
				tx.executeSql("INSERT INTO weight(id,value) VALUES(1,'81.4')");
				tx.executeSql("INSERT INTO weight(id,value) VALUES(2,'80.9')");
				tx.executeSql("INSERT INTO weight(id,value) VALUES(3,'80.4')");
			 }
			
			

		</script>

	</head>
	<body>
		<div id="home" data-role="page">
			<div data-role="header">
				<h1>Body Performer</h1>
			</div>
				<!--script type="text/javascript" src="js/index.js"></script>
					<script type="text/javascript">
						app.initialize();
					</script-->
			<div data-role="content">
				<ul data-role="listview" data-inset="true">
					<li>
						<a href="#basic_map">
							<img src="images/63-runner.png" alt="runner" class="ui-li-icon">Track Route
						</a>
					</li>
					<li>
						<a href="#weight_add">
							<img src="images/138-scales.png" alt="scales" class="ui-li-icon">Change weight
						</a>
					</li>
					<li>
						<a href="#weight_list" >
							<img src="images/16-line-chart.png" alt="notepad" class="ui-li-icon">List Weight changes
						</a>
					</li>
					<li>
						<a href="#home">
							<img src="images/20-gear2.png" alt="gear" class="ui-li-icon">Settings
						</a>
					</li>
				</ul>

				<!--p id="geolocation">Finding geolocation...</p-->
			</div>
		</div>
		
		<div id="basic_map" data-role="page">
			<div data-role="header">
				<h1>Track Route</h1>
			</div>
			<div data-role="content">	
				<div class="ui-bar-c ui-corner-all ui-shadow" style="padding:0.5em;">
					<div id="map_canvas" style="height:350px;"></div>
				</div>
			</div>
			<div data-role="footer" class="ui-bar">
				<a href="#home" data-role="button" data-icon="home">Return</a>
			</div>
		</div>
		<div data-role="page" id="weight_add">

			<div data-role="header">
				<h1>Change Weight</h1>
			</div>

			<div data-role="content">	
				<form id="changeWeightForm" method="post">
					<input type="hidden" name="weightId" id="weightId" value="">
					<div data-role="fieldcontain">
						<label for="weightValue">Weigth:</label>
						<input type="number" name="weightValue" id="weightValue" step="0.01" min="0" />
					</div>
					<!--div data-role="fieldcontain">
							<label for"time">Time</label>
							<input type="time" name="time" id="time" />
					</div-->
					<!--div data-role="fieldcontain">
							<label for"date">Date</label>
							<input type="date" name="date" id="date" />
					</div-->
					<!--div data-role="fieldcontain">
							<label for"datetime">Datetime</label>
							<input type="datetime" name="datetime" id="datetime" />
					</div-->
					
					<!--div data-role="fieldcontain"-->	
						<input type="submit" id="changeWeightForm" value="Save Weight"/>
					<!--/div-->
				</form>
			</div>
			
			<div data-role="footer" class="ui-bar">
				<a href="#home" data-role="button" data-icon="home">Return</a>
			</div>


		</div>
		
		<div data-role="page" id="weight_list">

			<div data-role="header">
				<h1>List Weight</h1>
			</div>

			<div data-role="content">	
				<div id="wrapper">
					<ul id="weightList" data-role="listview" data-inset="true"></ul>
				</div>

				<div id="busy"/>Loading...</div>

			</div>
			<div data-role="footer" class="ui-bar">
				<a href="#home" data-role="button" data-icon="home">Return</a>
			</div>


		</div>
	</body>
</html>